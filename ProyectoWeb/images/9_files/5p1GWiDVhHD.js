/*!CK:631633016!*//*1408994175,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["k8g2\/"]); }

__d("PhotosContentViewingSurfaces",[],function(a,b,c,d,e,f){e.exports={SNOWFLAKE:"snowflake",FULL_SCREEN_GALLERY:"full_screen_gallery",PERMALINK:"permalink",TAB_VIEW:"tab_view"};},null);
__d("PhotosLogType",[],function(a,b,c,d,e,f){e.exports={NAVIGATION:"navigation",VPV:"vpv",TIMETRACKING:"timetracking"};},null);
__d("PhotosReferrers",[],function(a,b,c,d,e,f){e.exports={SYNC:"shoebox",PHOTOS_TAB:"photos_tab",PHOTOS_OF_:"photos_of_",NOT_TAGGED_TAB:"not_tagged_tab",YOUR_PHOTOS:"your_photos",TIMELINE_PROFILE_PHOTO:"timeline_profile_photo",TIMELINE_COVER_PHOTO:"timeline_cover_photo",TIMELINE_PHOTO_WIDGET:"timeline_photo_widget",FEED:"feed",TIMELINE:"timeline",ALBUM:"albums_tab",PERMALINK:"permalink",FULL_SCREEN_GALLERY:"full_screen_gallery",SNOWFLAKE:"snowflake",PHOTO_SET:"photo_set"};},null);
__d("PhotosUserActionDirection",[],function(a,b,c,d,e,f){e.exports={UP:"up",RIGHT:"right",DOWN:"down",LEFT:"left"};},null);
__d("PhotosUserActionTypes",[],function(a,b,c,d,e,f){e.exports={SWIPE:"swipe",SCROLL:"scroll",CLICK:"click",KEYS:"keys"};},null);
__d("SnowflakeViewType",[],function(a,b,c,d,e,f){e.exports={PHOTO:"photo",STORY:"story",GRID:"grid"};},null);
__d("PhotoSetStoreCore",["KeyedCallbackManager","arrayContains","merge"],function(a,b,c,d,e,f,g,h,i){var j={_controller:new g(),getBySetToken:function(k,l){this._controller.executeOrEnqueue(k,l);},getLoadedPhotoSetTokens:function(){return Object.keys(this._controller.getAllResources());},getBySetTokenImmediate:function(k){return this._controller.getResource(k);},updateData:function(k){var l=k.photo_set,m={icon:l.icon,editURL:l.edit_url,title:l.title,contributors:l.contributors,owner:l.owner,contributorsElem:l.contributors_elem,facepileElem:l.facepile_elem,modifiedTime:l.modified_time,message:l.message,mediaCount:l.media_count,ufi:l.ufi,url:l.url,story:l.story,titleCardStyle:l.title_card_style,permalink:l.permalink,feedbackTarget:l.feedback_target,feedback:l.feedback,referrerType:l.referrer_type,taggingTypeaheadConfig:l.tagging_typeahead_config,taggingTypeaheadSuggestions:l.tagging_typeahead_suggestions,reportFlow:l.report_flow},n={};n[k.set_token]=m;this._controller.addResourcesAndExecute(n);},updateFeedbackData:function(k){var l=Object.keys(k),m=j.getLoadedPhotoSetTokens();m.forEach(function(n){var o=j.getBySetTokenImmediate(n);if(h(l,o.feedbackTarget))o.feedback=k[o.feedbackTarget].feedback;});},updatePhotoSetStoryFeedbackData:function(k){var l=Object.keys(k);l.forEach(function(m){var n=j.getBySetTokenImmediate(m);if(!n.story)return;n.story=i(n.story,{feedback:k[m].feedback});});}};e.exports=j;},null);
__d("ScrollablePhotoViewStateCore",["emptyFunction","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$ScrollablePhotoViewStateCore0=j.photoStore;this.$ScrollablePhotoViewStateCore1=j.viewer;this.$ScrollablePhotoViewStateCore2=j.setToken;this.$ScrollablePhotoViewStateCore3=j.updateCallback;this.$ScrollablePhotoViewStateCore4=j.subscribeUpdatePhotos;this.$ScrollablePhotoViewStateCore5=j.fetchInitData;this.$ScrollablePhotoViewStateCore6=j.initBatchSize;this.$ScrollablePhotoViewStateCore7=j.pageBatchSize;this.$ScrollablePhotoViewStateCore8=new h();}i.prototype.initViewState=function(){"use strict";this.$ScrollablePhotoViewStateCore8.addSubscriptions(this.$ScrollablePhotoViewStateCore4(this.updateData.bind(this)));if(this.$ScrollablePhotoViewStateCore0.hasBeenCreated(this.$ScrollablePhotoViewStateCore2)){var j=this.$ScrollablePhotoViewStateCore0.getAvailableRange(this.$ScrollablePhotoViewStateCore2).length;if(j>=this.$ScrollablePhotoViewStateCore6||!this.$ScrollablePhotoViewStateCore0.hasNextPage(this.$ScrollablePhotoViewStateCore2))this.syncState();return;}this.$ScrollablePhotoViewStateCore5(this.$ScrollablePhotoViewStateCore2);};i.prototype.hasNextPage=function(){"use strict";return (this.$ScrollablePhotoViewStateCore0.hasBeenCreated(this.$ScrollablePhotoViewStateCore2)&&this.$ScrollablePhotoViewStateCore0.hasNextPage(this.$ScrollablePhotoViewStateCore2));};i.prototype.fetchMore=function(j){"use strict";if(!this.hasNextPage())return;this.$ScrollablePhotoViewStateCore0.getItemsAfterIndex(this.$ScrollablePhotoViewStateCore2,this.$ScrollablePhotoViewStateCore0.getEndIndex(this.$ScrollablePhotoViewStateCore2),this.$ScrollablePhotoViewStateCore7,j||g);};i.prototype.destroy=function(){"use strict";this.$ScrollablePhotoViewStateCore8.release();};i.prototype.updateData=function(j){"use strict";if(j.set_id!=this.$ScrollablePhotoViewStateCore2)return;var k=j.query_results&&j.query_results.result_type;if(k=='init'){this.$ScrollablePhotoViewStateCore0.executePostCreate(this.$ScrollablePhotoViewStateCore2,function(){this.syncState();}.bind(this));}else this.syncState();};e.exports=i;},null);
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f,g,h){var i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;},null);
__d("subscribeToArbiterUpdatePhotos",["Arbiter"],function(a,b,c,d,e,f,g){function h(i){return g.subscribe('update-photos',function(j,k){i(k);});}e.exports=h;},null);
__d("PhotoSetStore",["Arbiter","PhotoSetStoreCore"],function(a,b,c,d,e,f,g,h){g.subscribe('update-photosets',function(i,j){h.updateData(j);});e.exports=h;},null);
__d("SnowflakeLogger",["BanzaiLogger","PhotosContentViewingSurfaces","CurrentUser","md5","userAction"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){"use strict";this.sessionID=j(i.getID()+Date.now());this.referrer=m;}l.prototype.photoViewed=function(m){"use strict";g.log('PhotoImpressionsLoggerConfig',{session_id:this.sessionID,action:m.actionType,action_direction:m.actionDirection,timestamp:Date.now(),content_id:m.photo.id,logtype:m.logtype,owner_id:m.photo.owner.id,referrer:this.referrer.surface,referrer_id:this.referrer.id,referrer_type:this.referrer.type,tracking:m.tracking,viewing_surface:h.SNOWFLAKE});};l.prototype.open=function(){"use strict";k('snowflake').uai('open');};l.prototype.close=function(){"use strict";k('snowflake',null,null,{mode:'DEDUP'}).uai('close');};e.exports=l;},null);
__d("SnowflakeMediaDimensions",["SnowflakeConstants","PhotoResizeMath","getViewportDimensions"],function(a,b,c,d,e,f,g,h,i){var j=24,k=2/3,l={getScaledMediaDimensions:function(m){var n=this.getStoryViewWidth();return m.map(function(o){var p=o.image.width/o.image.height;if(!this.shouldUseBlur()){if(p>k){return this._getMediaDimensionsAndPhotoVersion(false,o.full_width_image.width,o.full_width_image.height,n,o.full_width_image.height*n/o.full_width_image.width,'stretch');}else return this._getMediaDimensionsAndPhotoVersion(true,o.cropped_image.width,o.cropped_image.height,n,o.cropped_image.height*n/o.cropped_image.width,'stretch');}else{var q=this._getMaxPhotoHeight(p);return this._getMediaDimensionsAndPhotoVersion(false,o.full_width_image.width,o.full_width_image.height,n,Math.min(q,o.full_width_image.height),'contain');}}.bind(this));},getStoryViewWidth:function(){return this.getStoryViewBorderBoxWidth()-2*j;},getStoryViewBorderBoxWidth:function(){var m=i().height;if(m<=g.MIN_BROWSER_HEIGHT){return g.OVERLAY_SMALL_WIDTH;}else if(m<=g.MEDIUM_BROWSER_HEIGHT){return g.OVERLAY_LARGE_WIDTH;}else return g.OVERLAY_EXTRA_LARGE_WIDTH;},shouldUseBlur:function(){var m=i().height;if(m<=g.MIN_BROWSER_HEIGHT){return g.BLUR_ON_SMALL_WIDTH;}else if(m<=g.MEDIUM_BROWSER_HEIGHT){return g.BLUR_ON_LARGE_WIDTH;}else return g.BLUR_ON_EXTRA_LARGE_WIDTH;},_getMaxPhotoHeight:function(m){var n=g.LETTER_BOX_ASPECT_RATIO||1,o=g.BOUNDING_BOX||1;if(m<n)return this.getStoryViewWidth()/o;return this.getStoryViewWidth();},_getMediaDimensionsAndPhotoVersion:function(m,n,o,p,q,r){var s=h.getScaledPhotoDimensions(n,o,p,q,r);s.useCropped=m;return s;}};e.exports=l;},null);
__d("SnowflakePropTypes",["curry","isNode"],function(a,b,c,d,e,f,g,h){function i(j,k,l,m){var n=typeof k[l]!=='undefined';if(n&&!h(k[l])||!n&&j)return new Error(("Invalid prop `"+l+"` supplied to `"+m+"`, ")+("expected a DOM node."));}e.exports={isNode:g(i,false),requireNode:g(i,true)};},null);
__d("SnowflakeTagBox.react",["CSS","Image.react","React","Rect","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:'SnowflakeTagBox',propTypes:{tag:i.PropTypes.string.isRequired,fromFaceBox:i.PropTypes.bool,displayRect:i.PropTypes.instanceOf(j).isRequired,show:i.PropTypes.bool},onMouseEnter:function(){g.addClass(this.refs.tagBox.getDOMNode(),'hover');},onMouseLeave:function(){g.removeClass(this.refs.tagBox.getDOMNode(),'hover');},render:function(){var n=this.props.displayRect.getTop()+"%",o=this.props.displayRect.getLeft()+"%",p=this.props.displayRect.w()+"%",q=this.props.displayRect.h()+"%";return (i.createElement(i.DOM.div,{className:(("fbPhotosPhotoTagboxBase")+(' '+"tagBox")+(this.props.show?' '+"hover":'')),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"tagBox",style:{top:n,left:o,width:p,height:q}},i.createElement(i.DOM.div,{className:"borderTagBox"},i.createElement(i.DOM.div,{className:"innerTagBox"},i.createElement(i.DOM.div,{className:"ieContentFix"}))),i.createElement(i.DOM.div,{className:(("tag")+(this.props.fromFaceBox?' '+"fromFaceBox":''))},i.createElement(i.DOM.div,{className:"tagPointer"},i.createElement(h,{src:l('/images/light_pointer_padded_upward.png'),className:"tagArrow"}),i.createElement(i.DOM.div,{className:"tagName"},this.props.tag)))));}});e.exports=m;},null);
__d("AggregatedEntitiesLinkInterpolator",["React","TooltipLink.react"],function(a,b,c,d,e,f,g,h){function i(j,k){var l=g.createElement(g.DOM.div,null,k.sample_entities.map(function(m){return g.createElement(g.DOM.div,null,m.name);}));return (g.createElement(h,{className:"aggregatedEntitiesLink",position:"above",tooltip:l,ajaxify:k.pb_dialog_uri,href:k.pb_page_uri,rel:"dialog"},j));}e.exports=i;},null);
__d("SnowflakeTextWithEntities.react",["AggregatedEntitiesLinkInterpolator","HovercardLinkInterpolator","Image.react","React","ReactPropTypes","URI","TruncatedTextWithEntities.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(q){return !q.isLinkshimURI()&&!q.getPath().endsWith('/media/set/')&&!q.getPath().endsWith('/media_set/');}var p=j.createClass({displayName:'SnowflakeTextWithEntities',propTypes:{text:k.object.isRequired,maxLines:k.number,maxLength:k.number},linkInterpolator:function(q,r){if(r.entity){var s=new l(r.entity.url);r.entity.external=!o(s);return h(q,r,s.isLinkshimURI());}if(r.entity_with_image){var t=r.entity_with_image.image;return (j.createElement(i,{className:"_4p3_",src:t.uri,height:t.height,width:t.width}));}return g(q,r);},render:function(){return (j.createElement(m,Object.assign({},this.props,{interpolator:this.linkInterpolator,text:this.props.text.text,ranges:this.props.text.ranges,aggregatedRanges:this.props.text.aggregated_ranges,imageRanges:this.props.text.image_ranges,maxLines:this.props.maxLines,maxLength:this.props.maxLength,renderEmoticons:true,renderEmoji:true})));}});e.exports=p;},null);
__d("SnowflakeUFI.react",["DOMContainer.react","React","SnowflakePropTypes","UFIConstants","UFIToplevelCommentList","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.createClass({displayName:'SnowflakeUFI',propTypes:{ufi:i.requireNode,showNotch:h.PropTypes.bool,feedbackID:h.PropTypes.string},getInitialState:function(){return {visible:true};},render:function(){var n=k.getCommentList(this.props.feedbackID,j.UFICommentOrderingMode.CHRONOLOGICAL),o=(("_3615")+(this.state.visible?' '+"_47f4":'')+(n.count<1?' '+"_1tme":''));return (h.createElement(h.DOM.div,{className:o},h.createElement(g,null,this.props.ufi)));}});e.exports=m;},null);
__d("SnowflakePhoto.react",["Bootloader","DOMContainer.react","Event","Link.react","React","SnowflakeMediaDimensions","SnowflakePropTypes","SnowflakeTagBox.react","SnowflakeTextWithEntities.react","SnowflakeUFI.react","SnowliftSkinning","SubscriptionsHandler","Timestamp.react","XUIText.react","cx","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=k.PropTypes,x=k.createClass({displayName:'SnowflakePhoto',propTypes:{photo:w.object.isRequired,setToken:w.string.isRequired,ufi:m.isNode,width:w.number,height:w.number,useCropped:w.bool,index:w.number.isRequired,snowliftData:w.object.isRequired,firstInSet:w.string},getInitialState:function(){return {imageLoaded:false,highlightedTag:null};},componentDidMount:function(){this.handler=new r();var y=new Image();y.onload=function(){if(this.isMounted())this.setState({imageLoaded:true});}.bind(this);y.src=this.props.photo.image.uri;this.handler.addSubscriptions(i.listen(this.refs.footer.getDOMNode(),'mousemove',v(this.onMouseFooter,150)));},componentWillUnmount:function(){this.handler.release();},getImage:function(){var y=this.getPhotoCardStyle();if(this.state.imageLoaded){var z=this.props.photo,aa=l.shouldUseBlur(),ba=aa||!this.props.useCropped?z.full_width_image:z.cropped_image;return (k.createElement(k.DOM.img,{className:"_3614",src:ba.uri,style:y}));}return (k.createElement(k.DOM.div,{className:"_1qaz",style:y}));},getCaptionAndTags:function(){var y=this.props.photo.message,z=this.props.photo.taglist_elem;if(y)y=(k.createElement(t,null,k.createElement(o,{text:y})));if(z.children.length>0){z=(k.createElement(h,null,this.props.photo.taglist_elem));}else z=null;if(!z&&!y)return;return (k.createElement(k.DOM.div,{className:"_3613"},y,z));},getMetadata:function(){var y=this.props.photo.created_time;if(!y)return;return (k.createElement(k.DOM.div,{className:"_1h6j"},k.createElement(s,{verbose:y.verbose,time:y.time,text:y.text})));},getFooter:function(){var y=null;if(this.props.ufi)y=(k.createElement(p,{ufi:this.props.ufi,feedbackID:this.props.photo.id}));return (k.createElement(k.DOM.div,{ref:"footer",className:"_2wab"},this.getCaptionAndTags(),y));},onClickPhoto:function(event){var y=event.which&&event.which===2,z=event.altKey||event.ctrlKey||event.metaKey||event.shiftKey;if(y||z)return;var aa=q.snowliftClasses;g.loadModules(["PhotoSnowlift"],function(ba){ba.bootstrap(this.props.snowliftData.ajaxify,this.refs.photoLink.getDOMNode());ba.getInstance().setupFromSnowflake(aa,this.props.firstInSet);}.bind(this));event.nativeEvent.prevent();},onMouseFooter:function(y){var z=y.target.getAttribute('data-tag');if(z){this.setState({highlightedTag:z});}else if(this.state.highlightedTag)this.setState({highlightedTag:null});},getPhotoCardStyle:function(){return {width:this.props.width,height:this.props.height};},render:function(){var y=this.props.photo.tag_boxes.map(function(da){return (k.createElement(n,{show:da.id===this.state.highlightedTag,tag:da.actor,fromFaceBox:da.from_face_box,displayRect:da.display_rect}));}.bind(this)),z=this.props.width<l.getStoryViewWidth(),aa=l.shouldUseBlur(),ba=null;if(aa&&z)ba={backgroundImage:"linear-gradient(             to right,             rgba(255, 255, 255, 0.7),             rgba(255, 255, 255, 0.7)           ),           url("+this.props.photo.blured_image.uri+')',backgroundSize:'100% 100%'};var ca=this.getPhotoCardStyle();return (k.createElement(k.DOM.div,{ref:"root"},k.createElement(k.DOM.div,{className:(("_3616")+(z?' '+"_u3v":'')+(aa?' '+"_5ic4":'')),style:ba},k.createElement(k.DOM.div,{className:"_27g5",style:ca,'data-index':this.props.index},k.createElement(j,{onClick:this.onClickPhoto,ajaxify:this.props.snowliftData.ajaxify,href:this.props.snowliftData.href,ref:"photoLink"},this.getImage(),k.createElement(k.DOM.div,{className:"fbPhotosPhotoTagboxes tagContainer"},k.createElement(k.DOM.div,{className:"tagsWrapper",style:ca},y))))),this.getFooter()));}});e.exports=x;},null);
__d("SnowflakeKeyboardShortcuts",["KeyboardShortcuts","SubscriptionsHandler","emptyFunction"],function(a,b,c,d,e,f,g,h,i){function j(){"use strict";this.subscriptions=new h();this.$SnowflakeKeyboardShortcuts0=i;this.$SnowflakeKeyboardShortcuts1=i;this.$SnowflakeKeyboardShortcuts2=i;this.$SnowflakeKeyboardShortcuts3=false;}j.prototype.enable=function(){"use strict";this.subscriptions.addSubscriptions(g.register('j',function(){return this.$SnowflakeKeyboardShortcuts0(1);}.bind(this)),g.register('k',function(){return this.$SnowflakeKeyboardShortcuts0(-1);}.bind(this)),g.register('RIGHT',function(){return this.$SnowflakeKeyboardShortcuts0(1);}.bind(this)),g.register('LEFT',function(){return this.$SnowflakeKeyboardShortcuts0(-1);}.bind(this)),g.register('c',function(){return this.$SnowflakeKeyboardShortcuts2(-1);}.bind(this)),g.register('l',function(){return this.$SnowflakeKeyboardShortcuts1(-1);}.bind(this)));this.$SnowflakeKeyboardShortcuts3=true;return this;};j.prototype.setOnSelectionChangeCallback=function(k){"use strict";this.$SnowflakeKeyboardShortcuts0=k;return this;};j.prototype.setOnLikeCallback=function(k){"use strict";this.$SnowflakeKeyboardShortcuts1=k;return this;};j.prototype.setOnCommentCallback=function(k){"use strict";this.$SnowflakeKeyboardShortcuts2=k;return this;};j.prototype.disable=function(){"use strict";this.subscriptions.release();this.$SnowflakeKeyboardShortcuts3=false;};j.prototype.isEnabled=function(){"use strict";return this.$SnowflakeKeyboardShortcuts3;};e.exports=j;},null);
__d("SnowflakeStoryViewState",["AsyncRequest","PhotoStore","PhotoSetStore","SnowflakeConstants","SnowflakeMediaDimensions","ScrollablePhotoViewStateCore","getViewportDimensions","subscribeToArbiterUpdatePhotos"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(s,t,u,v,w,x){new g(j.INIT_PATH).setData({set:x,ei:s,referrer_profile_id:t,referrer_surface:u,first:w}).setOption('handleErrorAfterUnload',true).setErrorHandler(v).send();}for(var p in l)if(l.hasOwnProperty(p))r[p]=l[p];var q=l===null?null:l.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=l;function r(s){"use strict";var t=j.INIT_QUERY_BATCH_SIZE||8;l.call(this,{photoStore:h,viewer:s.viewer,setToken:s.setToken,updateCallback:s.updateCallback,subscribeUpdatePhotos:n,fetchInitData:o.bind(null,s.entIdentifierToken,s.profileID,s.referrerSurface,s.errorCallback,t),initBatchSize:t,pageBatchSize:j.PAGE_QUERY_BATCH_SIZE||12});this.$SnowflakeStoryViewState0=s.setToken;this.$SnowflakeStoryViewState1=s.updateCallback;}r.prototype.updateScaledMediaDimensions=function(){"use strict";if(!h.hasBeenCreated(this.$SnowflakeStoryViewState0))return;var s=h.getItemsInAvailableRange(this.$SnowflakeStoryViewState0),t=k.getScaledMediaDimensions(s);this.$SnowflakeStoryViewState1({scaledMediaDimensions:t,viewportWidth:m().width});};r.prototype.syncState=function(){"use strict";i.getBySetToken(this.$SnowflakeStoryViewState0,function(s){return this.$SnowflakeStoryViewState1({photoSet:s});}.bind(this));this.updateScaledMediaDimensions();this.$SnowflakeStoryViewState1({media:h.getItemsInAvailableRange(this.$SnowflakeStoryViewState0),hasNextPage:h.hasNextPage(this.$SnowflakeStoryViewState0)});};e.exports=r;},null);
__d("SnowflakeViewportTracking",["DOM","DOMDimensions","PhotosLogType","ViewportTracking","csx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=55;for(var n in j)if(j.hasOwnProperty(n))p[n]=j[n];var o=j===null?null:j.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=j;function p(){"use strict";if(j!==null)j.apply(this,arguments);}p.prototype.getDataFromConfig=function(q){"use strict";this.$SnowflakeViewportTracking0=q.logViewportTracking||l;this.$SnowflakeViewportTracking1=q.snowflakeMediaCollection;this.isTimetrackingEnabled=1;this.timeout=q.record_delay;this.useStoriesCaching=true;};p.prototype.getTimeout=function(){"use strict";return this.timeout;};p.prototype.getAllStories=function(){"use strict";if(this.$SnowflakeViewportTracking1.isMounted()){var q=this.$SnowflakeViewportTracking1.getDOMNode();return g.scry(q,"._27g5");}return [];};p.prototype.getStoryID=function(q){"use strict";return q.getAttribute('data-index');};p.prototype.getDataToLog=function(q){"use strict";return {gt:{evt:m,story_height:h.getElementDimensions(q).height,viewport_height:this.cachedViewportHeight}};};p.prototype.isVisible=function(q){"use strict";var r=h.getElementDimensions(q);return o.isVisible.call(this,q,this.isLoose,.5*r.height);};p.prototype.sendDataToLog=function(q,r,s){"use strict";var t={index:this.getStoryID(q)};t.tracking=(r.gt)?r.gt:r.ft;t.logtype=(t.tracking.evt==m)?i.VPV:i.TIMETRACKING;delete t.tracking.evt;this.$SnowflakeViewportTracking0(t);};e.exports=p;},null);
__d("SnowflakeMediaCollection.react",["Arbiter","Animation","Banzai","Event","PhotosLogType","React","SnowflakeConstants","SnowflakeLogger","SnowflakePhoto.react","SnowflakeKeyboardShortcuts","SnowflakeStoryViewState","SnowflakeViewportTracking","SubscriptionsHandler","PhotosUserActionDirection","PhotosUserActionTypes","Vector","clamp","getDocumentScrollElement","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=l.PropTypes,aa=150,ba=.5,ca=5,da=1000,ea=10,fa=250,ga=500,ha=l.createClass({displayName:'SnowflakeMediaCollection',propTypes:{media:z.array.isRequired,onScrolledToSelectedPhoto:z.func,setToken:z.string.isRequired,scaledMediaDimensions:z.array.isRequired,photoID:z.string,viewState:z.instanceOf(q),referrer:z.object,isPermalink:z.bool},getInitialState:function(){var ia=this.props.media,ja=this.props.photoID,ka=null;for(var la=0;la<ia.length;la++)if(ia[la].id==ja){ka=la;break;}return {selectedIndex:ka,fetchAtIndex:this.getFetchAtIndex(ia),isSnowliftOpen:false};},shouldComponentUpdate:function(ia,ja){return this.props.media.length!==ia.media.length||this.props.scaledMediaDimensions!==ia.scaledMediaDimensions||this.state.selectedIndex!==ja.selectedIndex;},componentDidMount:function(){this.handler=new s();var ia=this.state.selectedIndex;this.logger=new n(this.props.referrer);this.logger.open();i.subscribe(i.SHUTDOWN,function(){if(this.isMounted())this.logger.close();}.bind(this));setTimeout(function(){this.scrollElement=x();this.scrollToPhotoOnMount(ia);this.props.onScrolledToSelectedPhoto&&this.props.onScrolledToSelectedPhoto();}.bind(this),0);this.keyboardShortcuts=new p().setOnSelectionChangeCallback(this.onSelectionChange);setTimeout(function(){return this.keyboardShortcuts.enable();}.bind(this),0);if(this.props.viewState)this.handler.addSubscriptions(j.listen(window,'scroll',y(this.onScroll,da)));if(m.VPV_LOGGING_GK)setTimeout(function(){this.viewportTracking=new r();this.viewportTracking.init({conservative_initial_logging:false,logViewportTracking:this.logViewportTracking,record_delay:1000,scroll_only:true,snowflakeMediaCollection:this});}.bind(this),0);this.handler.addSubscriptions(g.subscribe('PhotoSnowlift.DATA_CHANGE',function(ja,ka){return this.onSnowliftPage(ka);}.bind(this),g.SUBSCRIBE_NEW),g.subscribe('PhotoSnowlift.CLOSE',function(ja,ka){return this.onSnowliftClose(ka.fbid,0);}.bind(this),g.SUBSCRIBE_NEW));setTimeout(function(){return this.onScroll();}.bind(this),0);},componentWillUnmount:function(){this.logger.close();if(this.viewportTracking)this.viewportTracking.cleanup();this.keyboardShortcuts.disable();this.stopScroll();this.handler.release();},componentDidUpdate:function(ia,ja){if(this.state.selectedIndex!==ja.selectedIndex||this.props.media.length!==ia.media.length)if(this.state.selectedIndex!==ja.selectedIndex&&this.state.selectedIndex===null){this.scrollToTitleCard();}else if(this.state.selectedIndex===this.props.media.length){this.scrollToBottom();}else if(this.state.selectedIndex!==ja.selectedIndex){var ka=this.props.media[this.state.selectedIndex];if(ka){this.logger.photoViewed({actionDirection:this.getKeyboardUserActionDirection(ja.selectedIndex,this.state.selectedIndex),actionType:u.KEYS,logtype:k.NAVIGATION,photo:ka,referrer:this.props.referrer});this.scrollToPhoto(this.state.selectedIndex,this.state.isSnowliftOpen?0:null);}}if(this.props.media.length!==ia.media.length){this.setState({fetchAtIndex:this.getFetchAtIndex(this.props.media,ia.media)});if(this.viewportTracking)this.viewportTracking.invalidateAllStoriesCache();}},logViewportTracking:function(ia){this.logger.photoViewed({actionType:u.SCROLL,photo:this.props.media[ia.index],referrer:this.props.referrer,logtype:ia.logtype,tracking:ia.tracking});},getIndexByFBID:function(ia){for(var ja=0;ja<this.props.media.length;ja++)if(this.props.media[ja].id==ia)return ja;return -1;},onSnowliftPage:function(ia){this.setState({isSnowliftOpen:true});var ja=this.getIndexByFBID(ia.fbid);if(ja===-1){if(this.state.selectedIndex+ia.movement>=this.props.media.length&&this.props.viewState.hasNextPage()){this.props.viewState.fetchMore(function(){return setTimeout(function(){return this.scrollToPhoto(this.state.selectedIndex);}.bind(this));}.bind(this));this.setState({selectedIndex:this.state.selectedIndex+ia.movement});this.scrollToBottom();}}else this.setState({selectedIndex:ja});},onSnowliftClose:function(ia,ja){this.isMounted()&&this.setState({isSnowliftOpen:false});if(ia==1||ia==null||ja>=ca)return;var ka=this.getIndexByFBID(ia);if(this.state.selectedIndex===ka)return;if(ka<0){setTimeout(function(){return this.onSnowliftClose(ia,ja+1);}.bind(this),fa);return;}setTimeout(function(){if(this.isMounted())this.setState({selectedIndex:ka});}.bind(this),ga);},onScroll:function(ia){var ja=this.refs[this.state.fetchAtIndex];if(ja&&this.isComponentAboveFold(ja))this.props.viewState.fetchMore();},isComponentAboveFold:function(ia){var ja=ia.getDOMNode(),ka=v.getViewportDimensions(),la=v.getElementPositionRelativeToScrollElement(ja,this.scrollElement),ma=v.getScrollPosition();return la.y-ka.y-ma.y<0;},getFetchAtIndex:function(ia,ja){var ka=ja?ja.length:0,la=ia.length-ka;return ka+Math.floor(la*ba);},onSelectionChange:function(ia){var ja=this.state.selectedIndex;if(ja===null){if(ia<0){return;}else ja=0;}else if(ja===0&&ia<1){ja=null;}else ja=w(0,ja+ia,this.props.media.length);this.setState({selectedIndex:ja});},scrollToPhotoOnMount:function(ia){if(ia===0){var ja=this.refs[ia];if(!ja)return;ja=ja.getDOMNode();var ka=v.getElementPosition(ja,'document'),la=v.getElementDimensions(ja),ma=v.getViewportDimensions();if(ka.y+la.y<ma.y){this.scrollToTitleCard();return;}}if(!this.props.isPermalink)this.scrollToPhoto(ia,0);},scrollToPhoto:function(ia,ja){var ka=this.refs[ia];if(!ka)return;ka=ka.getDOMNode();var la=v.getViewportDimensions(),ma=v.getElementPositionRelativeToScrollElement(ka,this.scrollElement),na=ka.clientHeight;if(na>la.y){ma=ma.sub(0,ea/2);}else ma=ma.sub(0,la.y/2-na/2);this.scrollToPosition(ma,ja);},scrollToTitleCard:function(){this.scrollToPosition(new v(0,0,'document'));},scrollToBottom:function(){this.scrollToPosition(new v(0,this.scrollElement.scrollHeight,'document'));},scrollToPosition:function(ia,ja,ka){this.stopScroll();var la=ia.convertTo('document');if(ja!==0){new h(this.scrollElement).to('scrollTop',la.y).to('scrollLeft',la.x).ease(h.ease.end).duration(typeof ja==='number'?ja:aa).ondone(ka).go();}else{this.scrollElement.scrollTop=la.y;this.scrollElement.scrollLeft=la.x;}},stopScroll:function(){this.scrollToPositionAnim&&this.scrollToPositionAnim.stop();},getKeyboardUserActionDirection:function(ia,ja){if(ia==null)return t.DOWN;if(ja==null)return t.UP;return ja>ia?t.DOWN:t.UP;},render:function(){var ia=this.props.media.map(function(ja,ka){var la=this.props.scaledMediaDimensions[ka];return (l.createElement(o,{ref:ka,key:ka,index:ka,photo:ja,setToken:this.props.setToken,ufi:ja.ufi,feedback:ja.feedback,width:la.width,height:la.height,useCropped:la.useCropped,snowliftData:ja.snowlift_data,firstInSet:this.props.media[0].id}));}.bind(this));return l.createElement(l.DOM.div,null,ia);}});e.exports=ha;},null);
__d("SnowflakeTitleCardMixin",["HovercardLink","Link.react","React","SnowflakePropTypes","SnowflakeTextWithEntities.react","Timestamp.react","cx","getObjectValues","SnowflakeConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('SnowflakeConstants').TITLE_CARD_STYLE,p=i.PropTypes,q=11,r=100,s={propTypes:{title:p.object,contributors:p.array,contributorsElem:j.isNode,facepileElem:j.isNode,time:p.object,mediaCount:p.number.isRequired,message:p.object,withPlaceDisplayData:p.string,titleCardStyle:p.oneOf(n(o)),story:p.object},getMessage:function(){var t=this.props.story&&this.props.story.message;if(!t)return;var u=(("_2z_r")+(t.text.length<=r?' '+"_5l5u":''));return (i.createElement(k,{className:u,text:t}));},getActors:function(){var t=this.props.contributors;if(t&&t.length)return t;var u=this.props.story;if(u&&u.actors)return u.actors;return [];},getDirectedTo:function(){var t=this.props.story;if(t&&t.to)return t.to;return null;},getActorLink:function(){var t=this.getActors()[0];if(!t)return;return (i.createElement(h,{href:t.url,'data-hovercard':g.constructEndpoint({id:t.id})},i.createElement(i.DOM.strong,null,t.name)));},getTimestamp:function(){var t=this.props.story,u=this.props.modifiedTime||t&&t.creation_time;if(!u)return null;return (i.createElement(l,{verbose:u.verbose,time:u.time,text:u.text}));},getPrivacyIcon:function(){var t=this.props.story&&this.props.story.privacy_scope;if(!t)return;var u=t.icon_image.width*q/t.icon_image.height;return (i.createElement(i.DOM.img,{className:"_2z_s",width:u,height:q,src:t.icon_image.uri}));},renderMetadata:function(t){t=t.filter(function(w){return w;});var u=[];for(var v=0;v<t.length-1;v++){u.push(t[v]);u.push(i.createElement(i.DOM.span,null,' ',"Â·",' '));}u.push(t[t.length-1]);return u;}};e.exports=s;},null);
__d("SnowflakeStoryTitleCard.react",["ImageBlock.react","InlineBlock.react","Link.react","React","SnowflakeConstants","SnowflakeTextWithEntities.react","SnowflakeTitleCardMixin","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=j.createClass({displayName:'SnowflakeStoryTitleCard',mixins:[m],getActorLine:function(){var p=this.getActors()[0];if(!p)return;var q=p.profile_picture,r=this.getRobotext();if(!r)r=this.getDirectedRobotext();return (j.createElement(g,null,j.createElement(i,{className:"_476s",href:p.url},j.createElement(j.DOM.img,{src:q.uri,width:k.ACTOR_PROF_PIC_SIZE,height:k.ACTOR_PROF_PIC_SIZE})),j.createElement(h,null,j.createElement(j.DOM.div,null,r),j.createElement(j.DOM.div,{className:"_2tvk"},this.getMetadata()))));},getRobotext:function(){var p=this.props.story,q=p&&p.title;if(!q)return;return (j.createElement(j.DOM.div,{className:"_2knb"},j.createElement(l,{text:q})));},getDirectedRobotext:function(){var p=this.getActors()[0],q=this.getDirectedTo();if(!p||!q)return;var r=this.makeTextWithEntities(p),s=j.createElement(j.DOM.img,{className:"mhs",src:"/images/icons/wall_arrow.gif"}),t=this.makeTextWithEntities(q);return (j.createElement(j.DOM.div,{className:"_2knb"},j.createElement(l,{text:r}),s,j.createElement(l,{text:t})));},makeTextWithEntities:function(p){return {text:p.name,aggregated_ranges:[],image_ranges:[],ranges:[{entity:this.makeEntity(p.name,p.id,p.url),offset:0,length:p.name.length}]};},makeEntity:function(p,q,r){return {external:false,name:p,id:q,url:r};},getMetadata:function(){return this.renderMetadata([this.getTimestamp(),this.getPrivacyIcon()]);},render:function(){return (j.createElement(j.DOM.div,{className:"_kgy"},this.getActorLine(),this.getMessage()));}});e.exports=o;},null);
__d("SnowflakeAlbumTitleCard.react",["DOMContainer.react","Image.react","Link.react","React","SnowflakeConstants","SnowflakeTextWithEntities.react","SnowflakeTitleCardMixin","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=j.createClass({displayName:'SnowflakeAlbumTitleCard',mixins:[m],getMetadata:function(){return (j.createElement(j.DOM.div,{className:"_2tvk"},this.renderMetadata([this.getTimestamp(),this.getPrivacyIcon()])));},getTitle:function(){if(!this.props.title)return;var p=j.createElement(l,{text:this.props.title});if(this.props.editURL)p=(j.createElement(i,{href:this.props.editURL},p));return (j.createElement(j.DOM.div,{className:"_a-z"},p));},getAlbumIcon:function(){var p=this.props.icon;if(p)return (j.createElement(j.DOM.span,{className:"_476s"},j.createElement(h,{width:k.ACTOR_PROF_PIC_SIZE,height:k.ACTOR_PROF_PIC_SIZE,className:"_4k68",src:p})));},getOwnerData:function(){var p;if(this.props.facepileElem){p=(j.createElement(g,null,this.props.facepileElem));}else p=(j.createElement(j.DOM.span,null,this.getAlbumIcon(),j.createElement(j.DOM.span,{className:"_2tvm"},this.getActorLink(),this.getMetadata())));return (j.createElement(j.DOM.div,{className:"_2tvl"},p));},render:function(){return (j.createElement(j.DOM.div,{className:"_a--"},this.getTitle(),this.getOwnerData(),this.getMessage()));}});e.exports=o;},null);
__d("SnowflakeTitleCard.react",["React","SnowflakeStoryTitleCard.react","SnowflakeAlbumTitleCard.react","cx","getObjectValues","SnowflakeConstants"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('SnowflakeConstants').TITLE_CARD_STYLE,m=g.PropTypes,n=g.createClass({displayName:'SnowflakeTitleCard',propTypes:{titleCardStyle:m.oneOf(k(l)),photoSet:m.object.isRequired},render:function(){var o=this.props.photoSet,p=this.props.titleCardStyle,q=(o.contributors&&o.contributors.length)||(o.story&&o.story.actors&&o.story.actors.length),r=(("_3sen")+(p===l.FEED_STORY?' '+"_2oy5":'')+(' '+"_4zk-")+(!q?' '+"hidden_elem":'')),s;if(p==l.ALBUM){s=i;}else s=h;return (g.createElement(g.DOM.div,{className:r},g.createElement(s,{icon:o.icon,editURL:o.editURL,title:o.title,contributors:o.contributors,contributorsElem:o.contributorsElem,facepileElem:o.facepileElem,modifiedTime:o.modifiedTime,mediaCount:o.mediaCount,message:o.message,story:o.story})));}});e.exports=n;},null);
__d("SnowflakeStoryView.react",["Arbiter","DOMContainer.react","Event","isNode","React","ReactLayeredComponentMixin","SnowflakeMediaCollection.react","SnowflakeMediaDimensions","SnowflakeStoryViewState","SnowflakeTitleCard.react","SubscriptionsHandler","XUIDialog.react","XUIDialogBody.react","XUIDialogButton.react","XUIDialogFooter.react","XUIDialogTitle.react","copyProperties","cx","fbt","getViewportDimensions","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=k.PropTypes,ca=k.createClass({displayName:'SnowflakeStoryView',propTypes:{setToken:ba.string.isRequired,photoID:ba.string,entIdentifierToken:ba.string,onViewportWidthChange:ba.func,referrer:ba.object,isPermalink:ba.bool,storyID:ba.string,onScrolledToSelectedPhoto:ba.func},mixins:[l],getInitialState:function(){return {media:[],imageDataFetched:false,hasNextPage:false,scaledMediaDimensions:null,photoSet:null,viewportWidth:z().width,error:null};},componentDidMount:function(){this.viewState=new o({viewer:this,setToken:this.props.setToken,entIdentifierToken:this.props.entIdentifierToken,profileID:this.props.referrer.id,updateCallback:this.onStateChanged,errorCallback:this.onError,referrerSurface:this.props.referrer.surface});this.viewState.initViewState();this._handler=new q();this._handler.addSubscriptions(i.listen(window,'resize',aa(function(){return this.viewState.updateScaledMediaDimensions();}.bind(this))));},componentWillUnmount:function(){this.viewState.destroy();delete this.viewState;this._handler.release();},onStateChanged:function(da){da.imageDataFetched=true;if(da.viewportWidth&&this.props.onViewportWidthChange)this.props.onViewportWidthChange(da.viewportWidth);this.setState(da);},onError:function(da){var ea="Se ha producido un error desconocido.";this.setState({error:ea});},getThrobbingFooter:function(){if(!this.state.imageDataFetched||!this.state.hasNextPage)return;return k.createElement(k.DOM.div,{className:"_2jrp"});},getReportFlow:function(){var da=this.state.photoSet;if(!da||!j(da.reportFlow))return;return (k.createElement(k.DOM.div,{className:"_2pqq"},k.createElement(h,null,da.reportFlow)));},getPhotoSetTitleCard:function(){if(!this.state.photoSet)return;var da=this.state.photoSet;return (k.createElement(p,{photoSet:da,titleCardStyle:da.titleCardStyle}));},getRootStyle:function(){var da=null;if(!this.state.imageDataFetched)da=this.props.height;return {height:da,width:n.getStoryViewBorderBoxWidth()};},getPhotoSetUFI:function(){if(!this.state.photoSet||this.state.photoSet.mediaCount!==this.state.media.length||!this.state.photoSet.ufi)return null;if(!this.ufiInitialized){this.ufiInitialized=true;g.inform('SnowflakeStoryView/ufiInitialized');}return (k.createElement(k.DOM.div,{className:"_1ib0"},k.createElement(k.DOM.div,{className:"_3615"},k.createElement(k.DOM.input,{type:"button",className:"invisible",autofocus:true}),k.createElement(h,null,this.state.photoSet.ufi))));},renderLayers:function(){return {errorDialog:k.createElement(r,{shown:!!this.state.error,width:600},k.createElement(v,null,k.createElement(k.DOM.span,null,"Error")),k.createElement(s,null,this.state.error),k.createElement(u,null,k.createElement(t,{label:"Close",use:"confirm",onClick:function(da){this.setState({error:null});}.bind(this)})))};},render:function(){var da=null;if(this.state.media.length&&this.viewState){var ea=w({},this.props.referrer);if(this.state.photoSet)ea.type=this.state.photoSet.referrerType;da=(k.createElement(m,{photoset:this.state.photoSet,media:this.state.media,scaledMediaDimensions:this.state.scaledMediaDimensions,photoID:this.props.photoID,viewState:this.viewState,referrer:ea,setToken:this.props.setToken,isPermalink:this.props.isPermalink,snowliftClasses:this.props.snowliftClasses,onScrolledToSelectedPhoto:this.props.onScrolledToSelectedPhoto}));}return (k.createElement(k.DOM.div,{className:(("_5b9c")+(!this.state.imageDataFetched?' '+"_222w":'')),'data-ownerid':this.props.storyID,style:this.getRootStyle()},k.createElement(k.DOM.div,{className:"_4eap",id:"snowflake_photos_content"},this.getReportFlow(),this.getPhotoSetTitleCard(),da),this.getThrobbingFooter(),this.getPhotoSetUFI()));}});e.exports=ca;},null);
__d("SpotlightSnowflakeViewer",["Arbiter","ArbiterMixin","DocumentTitle","CSS","Event","LitestandStoryInsertionStatus","PageTransitions","ModalLayer","PhotoSetStore","PhotoSnowlift","React","ReactPropTypes","SnowflakeConstants","SnowflakePermalinkUtils","SnowflakeStoryView.react","SpotlightViewer","SpotlightViewerBehaviorsMixin","SubscriptionsHandler","URI","cx","getViewportDimensions","goURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){var ca=false;function da(){ca=true;var ga=k.listen(window,'popstate',function(){ca=false;ga.remove();});}var ea=500,fa=q.createClass({displayName:'SpotlightSnowflakeViewer',propTypes:{setToken:r.string.isRequired,photoid:r.string,entIdentifierToken:r.string,isPermalink:r.bool,referrer:r.object,snowliftClasses:r.array,storyID:r.string,targetURI:r.string},mixins:[h,w],getInitialState:function(){return {open:true,height:aa().height,urlChanged:false,photoSelected:!this.props.photoid};},componentWillMount:function(){this.inform('open');this._storyInsertionBlocker=l.registerBlocker(function(){return this.state.open;}.bind(this));this.subscriptions=new x();this.subscriptions.addSubscriptions(g.subscribe('WebNFX/done',function(){return setTimeout(function(){return this.close(false);}.bind(this),ea);}.bind(this)),g.subscribe('PhotoSnowlift.OPEN',function(){return this.shouldShowCloseLink(aa().width);}.bind(this)),g.subscribe('PhotoSnowlift.CLOSE',function(){return this.shouldShowCloseLink(aa().width);}.bind(this)));},componentWillUnmount:function(){this.subscriptions.release();if(this._originalDocumentTitle)i.set(this._originalDocumentTitle);this._storyInsertionBlocker.unsubscribe();},componentDidMount:function(){this.previousURI=y.getMostRecentURI().getUnqualifiedURI();o.getBySetToken(this.props.setToken,function(ga){if(!this.state.open)return;if(!ga.permalink)return;if(ga.title){this._originalDocumentTitle=i.get();i.set(ga.title.text);}this.setState({urlChanged:true});var ha=t.parseURI(y.getNextURI());if(ha.setToken===this.props.setToken&&ha.entIdentifierToken===this.props.entIdentifierToken)return;ba(ga.permalink,false,this.props.isPermalink);}.bind(this));this.shouldShowCloseLink(aa().width);m.registerHandler(this.onPageTransition);},onPageTransition:function(ga){if(ca)return true;if(t.isPermalinkURI(ga.getPath())){m.transitionComplete(true);return true;}if(ga.getUnqualifiedURI().toString()===this.previousURI.toString()){this.close(true);m.transitionComplete(true);return true;}this.close(true);},isOpen:function(){return this.state.open;},closeShield:function(ga,ha){this.close(ha);},close:function(ga){if(!this.state.open||this.hasNavigatedBack)return;if(!ga&&!this.props.isPermalink&&this.state.urlChanged){da();a.history.go(-1);this.hasNavigatedBack=true;}setTimeout(function(){this.hasNavigatedBack=false;if(!this.state.open)return;this.setState({open:false},function(){this.inform('close');g.inform('PhotoSnowflake.CLOSE');if(ga)return;if(this.props.isPermalink){var ha=(this.props.targetURI?this.props.targetURI:'/');ba(ha);}}.bind(this));}.bind(this),0);},getFeedbackLink:function(){if(s.FEEDBACK_PATH)return (q.createElement(q.DOM.div,{className:"_1umf"},q.createElement(q.DOM.a,{href:s.FEEDBACK_PATH},"Feedback")));},onClick:function(ga){if(j.hasClass(ga.target,"_5fb4"))ga.target.parentNode.click();},onViewportWidthChange:function(ga){this.shouldShowCloseLink(ga);},shouldShowCloseLink:function(ga){j.conditionShow(this.refs.closeLink.getDOMNode(),ga>=722&&(p&&!p.getInstance().isOpen));},onBeforeHide:function(){if(p.getInstance().isReturningToStart())return false;if(!s.BEFORE_HIDE_SHIELD_GK)return true;var ga=n.getTopmostModalLayer().getLayerRoot();return j.hasClass(ga,"_5ero");},onScrolledToSelectedPhoto:function(){setTimeout(function(){return this.setState({photoSelected:true});}.bind(this),0);},render:function(){var ga=(("_5fb4")+(!this.state.photoSelected?' '+"_24i2":''));return (q.createElement(q.DOM.div,null,q.createElement(v,{ref:"spotlightViewer",open:this.state.open,onHide:this.closeShield,onBeforeHide:this.onBeforeHide,onClick:this.onClick,rootClassName:"_5ero",className:ga},q.createElement(u,{photoID:this.props.photoid,setToken:this.props.setToken,entIdentifierToken:this.props.entIdentifierToken,height:this.state.height,onViewportWidthChange:this.onViewportWidthChange,referrer:this.props.referrer,isPermalink:this.props.isPermalink,storyID:this.props.storyID,onScrolledToSelectedPhoto:this.onScrolledToSelectedPhoto})),q.createElement(q.DOM.div,{className:"_17ek"}),q.createElement(q.DOM.a,{ref:"closeLink",className:"_a-y",onClick:this.close.bind(this,false)}),this.getFeedbackLink()));}});e.exports=fa;},null);
__d("SpotlightSnowflakePhotoViewer",["ArbiterMixin","React","SpotlightViewer","SpotlightViewerAutoResize","SpotlightViewerBehaviorsMixin","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerDimensionMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerThumbnailMixin","SpotlightViewport","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=h.createClass({displayName:'SpotlightSnowflakePhotoViewer',mixins:[g,k,m,q,n],behaviors:[p,j],getViewerID:function(){return 'photoviewer';},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getInitialState:function(){this._subscriptions=new s();return {photoData:this._getInitialPhotoData(),open:true};},_enableSubscriptions:function(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},render:function(){var u=this.getMedia(),v=this.getStageDimensions(),w=this.props.useloadingindicator&&!this.state.photoData;return (h.createElement(i,{open:this.state.open,onHide:this.close},h.createElement(r,{media:u,showLoadingIndicator:w,stageDimensions:v,onClick:this._onClickViewport},h.createElement(l,{onClick:this.close}),this.props.disablepaging?null:h.createElement(o,null))));}});e.exports=t;},null);
__d("SnowflakeInit",["PageTransitions","Parent","React","PhotosReferrers","SnowflakePermalinkUtils","SnowflakeViewType","SpotlightSnowflakeViewer","SpotlightSnowflakePhotoViewer","SpotlightViewerInit","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q={_open:{},_getOpenKey:function(r,s){return r.setToken+'-'+s;},_isOpen:function(r,s){return !!this._open[this._getOpenKey(r,s)];},_setOpen:function(r,s,t){this._open[this._getOpenKey(r,s)]=t;},_transitionHandler:function(r,s){if(!k.isPermalinkURI(s)){g.registerHandler(this._transitionHandler.bind(this,r));return false;}var t=k.parseURI(s);if(this._isOpen(t,r))return false;q.init(t,r);g.transitionComplete(true);return true;},init:function(r,s,t){if(this._isOpen(r,s))return;var u=s==='photo'?n:m,v={surface:r.referrer,id:r.referrerID};if(!!t)v.surface=j.PERMALINK;var w=(i.createElement(u,{isPermalink:!!t,setToken:r.setToken,photoid:r.photoID,entIdentifierToken:r.entIdentifierToken,targetURI:r.targetURI,referrer:v,storyID:r.storyID}));this._setOpen(r,s,true);w=o.render(w,function(){this._setOpen(r,s,false);g.registerHandler(this._transitionHandler.bind(this,s));}.bind(this));},initStoryWithElem:function(r){this.init(q.getDataFromElem(r),l.STORY);},initPhotoWithElem:function(r){this.init(q.getDataFromElem(r),l.PHOTO);},getDataFromElem:function(r){var s=h.byClass(r,'uiStreamStory')||h.byClass(r,"_5jmm");return {setToken:r.getAttribute('data-set'),photoID:r.getAttribute('data-photoid'),entIdentifierToken:r.getAttribute('data-ei'),referrer:r.getAttribute('data-referrer'),referrerID:r.getAttribute('data-referrerid'),storyID:s&&s.id};}};e.exports=q;},null);